# 스레드에 관한 진실

- 스레드란?
    - 프로세스 내에서 실행되는 흐름의 단위이다.
    - 하나의 프로그램은 하나의 스레드를 가진다.
        - 이때, 일반적으로는 하나의 프로그램은 하나의 스레드를 가지고 있지만, 프로그램 환경에 따라 둘 이상의 쓰레드를 동시에 실행할 수 있다. 이러한 실행 방식을 `멀티스레드` 라고 한다.
    - 스레드의 종류
        - 사용자 레벨: 커널 영역의 상위에서 지원되며, 사용자 레벨 라이브러리를 통해 구현된다.
        - 커널 레벨 스레드 :

2.1 스레딩의 장점

- 읽기 쉬운 코드
- 공유 메모리를 통한 병렬처리
    - 쓰레드간 공유 메모리를 통신하면서, 코드에서 여러 CPU를 활용할 수 있다.
    - 만약, 공유메모리를 쓰지 않고 프로세스별 메모리 영영 복제를 통해 프로세스간 대량의 데이터를 상호 전달할 경우 상당히 많은 CPU및 메모리 전송 자원을 필요로 하기 때문이다.
    

** 위 장점 중, 파이썬 병렬성에 대해서는 의구심이 든다 **

- 멀티 스레드의 장점은 CPU가 여러 개일때, 각각 CPU가 스레드 하나씩 담당하는 방법으로 속도를 높일 수 있다는 것이다.
- 파이썬 인터프리터는 인터프리터 자체의 내부 상태를 보호하기 위해 GIL 이라는 전역락을 사용하고 있다.
    - = 락이 프로그램상 모든 스레드를 하나의 CPU에서만 처리하기 때문이다.
    - 병렬성에서 제한을 받고 있다.

2.2 스레딩의 단점

- 스레드는 자원 소모적이다.
- 스레딩은 처리량에 영향을 줄 수 있다.
    - 콘텍스트 전환 비용으로 인해 처리량에 영향이 있을 수 있다.
- 스레딩은 대규모 병행성에 대해 비효율적인 모델이다.

2.3 사례연구 : 로보과 식기

- 경합조건은 여러 쓰레드가 같은 리소스에 접근해, 하나이상의 스레드가 리소스에 write할 경우 발생한다
- 만약 쓰레드가 같은 자원에 대해 읽기만 한다면, 경쟁 조건은 일어나지 않는다.
- 쓰레드간 공유하는 객체를 immutable 로 만듦으로써 어느 쓰레드도 공유 자원을 업데이터 할 수 없게 하므로 thread safe 한다.